# MD.AI 技术方案

## 1. 项目概述

### 1.1 目标
构建一个类似 Typora 的 Markdown 查看/编辑软件，支持：
- 多平台运行（macOS/Windows/Linux/Web）
- 微信公众号排版主题
- 数学公式、Mermaid 图表
- 图片处理与存储
- 自定义字体和主题

### 1.2 参考项目
- [md2wechat](https://www.md2wechat.com/)
- [mmdeditor](https://mmdeditor.boxtech.icu/)
- [wechat.jeffjade](https://wechat.jeffjade.com/)
- [doocs/md](https://github.com/doocs/md) - 开源微信 Markdown 编辑器

---

## 2. 技术选型

### 2.1 方案对比

| 方案 | 开发时间 | 跨平台 | 主题定制 | 复杂度 | 推荐度 |
|------|---------|--------|---------|--------|--------|
| VSCode 扩展 | 1-2周 | ✅ | ⚠️ 有限 | 低 | ⭐⭐ |
| Web 应用 | 1-2周 | ✅ 浏览器 | ✅ 完全 | 低 | ⭐⭐⭐⭐ |
| Electron 桌面 | 2-3周 | ✅ | ✅ 完全 | 中 | ⭐⭐⭐ |
| Tauri 桌面 | 2-3周 | ✅ | ✅ 完全 | 中 | ⭐⭐⭐⭐⭐ |

### 2.2 推荐方案：Web + Tauri

**阶段一**：先做 Web 版本（快速验证）
**阶段二**：使用 Tauri 封装成桌面应用

**选择 Tauri 的理由**：
- 比 Electron 体积小 10 倍以上
- 性能更好，内存占用低
- 原生系统 API 支持好
- Rust 后端安全可靠

### 2.3 技术栈

```
前端框架: React 19 + TypeScript
构建工具: Vite 7
编辑器:   CodeMirror 6 或 Monaco Editor
Markdown: marked.js / markdown-it
公式渲染: KaTeX
图表渲染: Mermaid
桌面封装: Tauri 2.0
```

---

## 3. 核心功能模块

### 3.1 功能优先级

#### P0 - 核心功能（必须）✅ 已完成
- [x] Markdown 编辑器（CodeMirror 6 语法高亮）
- [x] 实时预览（普通 + 虚拟滚动双模式）
- [x] 主题切换（GitHub、微信优雅橙、清新绿、科技蓝）
- [x] 字体配置（字号调节）
- [x] 数学公式（KaTeX）
- [x] Mermaid 图表
- [x] 图片粘贴/拖拽插入

#### P1 - 重要功能 ✅ 已完成
- [x] 图片本地存储（Typora 风格 .assets 目录）
- [x] 文件管理（打开/保存/另存为 ⌘O/⌘S/⇧⌘S）
- [x] 快捷键支持
- [x] 大纲导航
- [x] 搜索替换（⌘F）
- [x] 自动保存（防抖 + 失焦 + 本地备份）
- [x] 大文件优化（虚拟滚动 + Web Worker）
- [x] 导出功能（HTML/PDF/PNG）
- [ ] 图床上传（GitHub/SM.MS）

#### P2 - 低优先级
- [ ] 微信公众号一键复制
- [ ] 所见即所得编辑模式
- [ ] 多标签页
- [ ] 拖拽分割线调整面板大小

---

## 4. 项目结构（当前实现）

```
md.ai/
├── docs/                      # 文档
│   └── 技术方案.md
├── src/
│   ├── components/            # React 组件
│   │   ├── Editor/            # CodeMirror 6 编辑器
│   │   │   ├── Editor.tsx     # 主编辑器 (含搜索替换)
│   │   │   ├── Editor.css
│   │   │   └── index.ts
│   │   ├── Preview/           # 预览组件
│   │   │   ├── Preview.tsx         # 普通预览
│   │   │   ├── VirtualPreview.tsx  # 虚拟滚动预览 (大文件)
│   │   │   ├── Preview.css
│   │   │   └── index.ts
│   │   ├── Outline/           # 大纲导航
│   │   │   ├── Outline.tsx
│   │   │   ├── Outline.css
│   │   │   └── index.ts
│   │   ├── ThemeSelector/     # 主题滑动选择器
│   │   │   ├── ThemeSelector.tsx
│   │   │   ├── ThemeSelector.css
│   │   │   └── index.ts
│   │   └── Toolbar/           # 工具栏 (文件菜单/设置)
│   │       ├── Toolbar.tsx
│   │       ├── Toolbar.css
│   │       └── index.ts
│   ├── themes/                # 主题样式
│   │   ├── base.css           # CSS 变量基础
│   │   ├── github.css         # GitHub 主题
│   │   ├── wechat-elegant.css # 微信优雅橙
│   │   ├── wechat-green.css   # 微信清新绿
│   │   ├── wechat-blue.css    # 微信科技蓝
│   │   └── index.ts
│   ├── lib/                   # 工具库
│   │   ├── markdown.ts        # Markdown 解析 (marked.js)
│   │   ├── markdown-blocks.ts # 块级解析 (虚拟滚动)
│   │   ├── block-diff.ts      # 增量 Diff
│   │   ├── math.ts            # KaTeX 公式
│   │   ├── mermaid.ts         # Mermaid 图表
│   │   ├── image.ts           # 图片处理 (Base64/本地)
│   │   ├── file.ts            # 文件操作 (Tauri/Web)
│   │   ├── export.ts          # 导出 HTML/PDF/PNG
│   │   └── performance.ts     # 防抖/节流工具
│   ├── stores/                # Zustand 状态管理
│   │   └── editor.ts          # 编辑器状态
│   ├── hooks/                 # 自定义 Hooks
│   │   ├── index.ts
│   │   ├── useAutoSave.ts     # 自动保存
│   │   └── useMarkdownWorker.ts # Web Worker
│   ├── workers/               # Web Workers
│   │   └── markdown.worker.ts # 后台 Markdown 解析
│   ├── types/                 # TypeScript 类型
│   │   └── index.ts
│   ├── App.tsx
│   ├── App.css
│   ├── index.css
│   └── main.tsx
├── src-tauri/                 # Tauri 后端
│   ├── src/
│   │   ├── lib.rs             # 插件注册
│   │   └── main.rs
│   ├── capabilities/
│   │   └── default.json       # 权限配置 (fs/dialog)
│   ├── Cargo.toml
│   └── tauri.conf.json
├── package.json
├── vite.config.ts
├── tsconfig.json
└── README.md
```

---

## 5. 详细设计

### 5.1 Markdown 解析

使用 `marked.js` + 自定义扩展：

```typescript
// lib/markdown.ts
import { marked } from 'marked';
import { markedHighlight } from 'marked-highlight';
import hljs from 'highlight.js';

// 配置代码高亮
marked.use(markedHighlight({
  langPrefix: 'hljs language-',
  highlight(code, lang) {
    const language = hljs.getLanguage(lang) ? lang : 'plaintext';
    return hljs.highlight(code, { language }).value;
  }
}));

// 自定义渲染器
const renderer = new marked.Renderer();

// 自定义图片渲染（支持尺寸控制）
renderer.image = (href, title, text) => {
  return `<img src="${href}" alt="${text}" title="${title || ''}" loading="lazy" />`;
};

export function parseMarkdown(content: string): string {
  return marked(content, { renderer });
}
```

### 5.2 数学公式（KaTeX）

```typescript
// lib/math.ts
import katex from 'katex';
import 'katex/dist/katex.min.css';

// 行内公式正则: $...$
const INLINE_MATH_REGEX = /\$([^\$]+)\$/g;

// 块级公式正则: $$...$$
const BLOCK_MATH_REGEX = /\$\$([^\$]+)\$\$/g;

export function renderMath(html: string): string {
  // 渲染块级公式
  html = html.replace(BLOCK_MATH_REGEX, (_, tex) => {
    try {
      return katex.renderToString(tex.trim(), {
        displayMode: true,
        throwOnError: false
      });
    } catch (e) {
      return `<span class="math-error">${tex}</span>`;
    }
  });

  // 渲染行内公式
  html = html.replace(INLINE_MATH_REGEX, (_, tex) => {
    try {
      return katex.renderToString(tex.trim(), {
        displayMode: false,
        throwOnError: false
      });
    } catch (e) {
      return `<span class="math-error">${tex}</span>`;
    }
  });

  return html;
}
```

### 5.3 Mermaid 图表

```typescript
// lib/mermaid.ts
import mermaid from 'mermaid';

mermaid.initialize({
  startOnLoad: false,
  theme: 'default',
  securityLevel: 'loose',
  fontFamily: 'var(--font-sans)'
});

let mermaidId = 0;

export async function renderMermaid(code: string): Promise<string> {
  const id = `mermaid-${mermaidId++}`;
  try {
    const { svg } = await mermaid.render(id, code);
    return `<div class="mermaid-container">${svg}</div>`;
  } catch (e) {
    return `<div class="mermaid-error">图表渲染错误: ${e}</div>`;
  }
}
```

### 5.4 主题系统

#### 基础变量定义

```css
/* themes/base.css */
:root {
  /* ===== 字体 ===== */
  --font-sans: "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
  --font-serif: "Source Han Serif SC", "Noto Serif SC", "Songti SC", serif;
  --font-mono: "JetBrains Mono", "Fira Code", "SF Mono", Consolas, monospace;
  
  /* ===== 字号 ===== */
  --font-size-base: 16px;
  --font-size-sm: 14px;
  --font-size-lg: 18px;
  --font-size-h1: 2em;
  --font-size-h2: 1.5em;
  --font-size-h3: 1.25em;
  --font-size-h4: 1em;
  --font-size-code: 0.9em;
  
  /* ===== 行高 ===== */
  --line-height: 1.8;
  --line-height-heading: 1.4;
  --line-height-code: 1.5;
  
  /* ===== 间距 ===== */
  --spacing-xs: 4px;
  --spacing-sm: 8px;
  --spacing-md: 16px;
  --spacing-lg: 24px;
  --spacing-xl: 32px;
  
  /* ===== 颜色（主题覆盖） ===== */
  --color-text: #333;
  --color-text-secondary: #666;
  --color-text-muted: #999;
  --color-bg: #fff;
  --color-bg-code: #f6f8fa;
  --color-border: #e1e4e8;
  --color-link: #0366d6;
  --color-accent: #0366d6;
}
```

#### 微信主题示例

```css
/* themes/wechat-elegant.css */
.theme-wechat-elegant {
  --font-sans: "Optima-Regular", "PingFang SC", sans-serif;
  --color-text: #3f3f3f;
  --color-accent: #ff6827;
  --color-bg-code: #fff5f5;
}

.theme-wechat-elegant .markdown-body {
  padding: 20px;
  max-width: 780px;
  margin: 0 auto;
}

.theme-wechat-elegant h1 {
  text-align: center;
  font-weight: bold;
  border-bottom: 2px solid var(--color-accent);
  padding-bottom: 10px;
}

.theme-wechat-elegant h2 {
  display: inline-block;
  font-weight: bold;
  background: var(--color-accent);
  color: #fff;
  padding: 2px 10px;
  border-radius: 3px;
  margin: 20px 0 10px;
}

.theme-wechat-elegant blockquote {
  border-left: 3px solid var(--color-accent);
  padding-left: 15px;
  color: var(--color-text-secondary);
  background: #f7f7f7;
  margin: 15px 0;
  padding: 10px 15px;
}

.theme-wechat-elegant code {
  background: var(--color-bg-code);
  color: #c7254e;
  padding: 2px 6px;
  border-radius: 3px;
}

.theme-wechat-elegant pre {
  background: #282c34;
  border-radius: 5px;
  padding: 15px;
  overflow-x: auto;
}

.theme-wechat-elegant pre code {
  background: transparent;
  color: #abb2bf;
  padding: 0;
}
```

### 5.5 字体配置系统

```typescript
// fonts/font-config.ts
export interface FontConfig {
  id: string;
  name: string;
  family: string;
  fallback: string[];
  webFont?: {
    url: string;
    format: 'woff2' | 'woff' | 'ttf';
  };
}

export const FONT_PRESETS: FontConfig[] = [
  {
    id: 'system-sans',
    name: '系统无衬线',
    family: 'system-ui',
    fallback: ['-apple-system', 'Segoe UI', 'Roboto', 'sans-serif']
  },
  {
    id: 'pingfang',
    name: '苹方',
    family: 'PingFang SC',
    fallback: ['Microsoft YaHei', 'sans-serif']
  },
  {
    id: 'source-han-serif',
    name: '思源宋体',
    family: 'Source Han Serif SC',
    fallback: ['Noto Serif SC', 'serif']
  },
  {
    id: 'jetbrains-mono',
    name: 'JetBrains Mono',
    family: 'JetBrains Mono',
    fallback: ['Fira Code', 'Consolas', 'monospace'],
    webFont: {
      url: 'https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap',
      format: 'woff2'
    }
  }
];

export function buildFontFamily(config: FontConfig): string {
  return [config.family, ...config.fallback].map(f => 
    f.includes(' ') ? `"${f}"` : f
  ).join(', ');
}
```

### 5.6 图片处理

```typescript
// lib/image.ts
export type ImageStorageStrategy = 'base64' | 'local' | 'cloud';

export interface ImageConfig {
  strategy: ImageStorageStrategy;
  maxSize?: number;        // 最大文件大小 (bytes)
  quality?: number;        // 压缩质量 0-1
  localPath?: string;      // 本地存储路径
  cloudProvider?: string;  // 云存储提供商
}

// 将文件转为 Base64
export function fileToBase64(file: File): Promise<string> {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result as string);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

// 处理粘贴的图片
export async function handlePastedImage(
  event: ClipboardEvent,
  config: ImageConfig
): Promise<string | null> {
  const items = event.clipboardData?.items;
  if (!items) return null;

  for (const item of items) {
    if (item.type.startsWith('image/')) {
      const file = item.getAsFile();
      if (!file) continue;

      switch (config.strategy) {
        case 'base64':
          return await fileToBase64(file);
        case 'local':
          // 需要 Tauri 后端支持
          return await saveToLocal(file, config.localPath!);
        case 'cloud':
          return await uploadToCloud(file, config.cloudProvider!);
      }
    }
  }
  return null;
}

// 插入 Markdown 图片语法
export function insertImageMarkdown(url: string, alt: string = 'image'): string {
  return `![${alt}](${url})`;
}
```

### 5.7 图片本地存储（已实现）

采用 **Typora 风格**：文档同名 `.assets` 目录

```
项目结构：
├── 我的文章.md
└── 我的文章.assets/
    ├── image-20260106-193000-a1b2.png
    └── image-20260106-193015-c3d4.png

Markdown 引用：
![图片描述](./我的文章.assets/image-20260106-193000-a1b2.png)
```

三种存储模式：
- `assets`: ./文档名.assets/ (推荐)
- `images`: ./images/
- `base64`: 内嵌到文档

### 5.8 文件操作（已实现）

```typescript
// lib/file.ts - 支持 Tauri 和 Web 双环境
export async function openFile(): Promise<{ content: string; path: string } | null>
export async function saveFile(content: string, currentPath?: string): Promise<string | null>
export async function saveFileAs(content: string): Promise<string | null>
```

快捷键：
- `⌘O` 打开文件
- `⌘S` 保存
- `⇧⌘S` 另存为

### 5.9 导出功能（已实现）

```typescript
// lib/export.ts
export async function exportHTML(content, theme, fileName)  // 完整 HTML 含样式
export async function exportPDF(content, theme, title)      // 调用打印
export async function exportImage(element, fileName)        // html2canvas 截图
```

导出 HTML 包含：
- 完整的 CSS 样式内嵌
- KaTeX 样式
- 主题样式
- Base64 图片保持

### 5.10 自动保存机制（已实现）

```typescript
// hooks/useAutoSave.ts
三重保障：
1. 防抖保存 - 停止输入 2 秒后自动保存
2. 失焦保存 - 窗口/标签页失去焦点时立即保存
3. 本地备份 - 每 30 秒 localStorage 备份，防止崩溃丢失

崩溃恢复：
- 启动时检测 24 小时内的备份
- 弹窗询问是否恢复
```

---

## 6. 大文件优化（已实现）

### 6.1 问题分析

| 问题 | 原因 | 影响 |
|------|------|------|
| DOM 爆炸 | 10万行 = 10万+ DOM 节点 | 内存飙升、页面卡死 |
| 渲染卡顿 | 每次输入全量重渲染 | 输入延迟 |
| 块切割 | 按行虚拟滚动 | 半截表格/代码块 |

### 6.2 解决架构

```
输入内容
   │
   ▼
┌─────────────────────────────────────┐
│  文档大小判断                        │
│  < 50KB  →  普通 Preview            │
│  > 50KB  →  VirtualPreview          │
└─────────────────────────────────────┘
   │
   ▼ (大文档)
┌─────────────────────────────────────┐
│  Web Worker (> 30KB 自动启用)       │
│  后台解析 → 不阻塞 UI               │
└─────────────────────────────────────┘
   │
   ▼
┌─────────────────────────────────────┐
│  块级解析器                          │
│  • 完整的 table 块                   │
│  • 完整的 code 块                    │
│  • 完整的 math/mermaid 块            │
└─────────────────────────────────────┘
   │
   ▼
┌─────────────────────────────────────┐
│  虚拟滚动                            │
│  • 只渲染可见区域                    │
│  • 200px 缓冲区                      │
│  • Intersection Observer 懒加载     │
└─────────────────────────────────────┘
   │
   ▼
┌─────────────────────────────────────┐
│  LRU 渲染缓存 (100 块)              │
│  避免重复渲染相同块                  │
└─────────────────────────────────────┘
```

### 6.3 关键实现

#### 块级解析器

```typescript
// lib/markdown-blocks.ts
export interface MarkdownBlock {
  id: string;
  type: 'heading' | 'paragraph' | 'code' | 'table' | 'list' | 'blockquote' | 'hr' | 'math' | 'mermaid' | 'image';
  content: string;
  level?: number;
}

// 将 Markdown 拆分为完整块，避免切割
export function parseMarkdownToBlocks(content: string): MarkdownBlock[]
```

#### Web Worker

```typescript
// hooks/useMarkdownWorker.ts
export function useMarkdownWorker({
  content,
  useWorker = true,
  threshold = 30000, // 30KB 以上使用 Worker
}): {
  blocks: MarkdownBlock[];
  isParsing: boolean;
  parseTime: number;
}
```

#### 虚拟滚动组件

```typescript
// components/Preview/VirtualPreview.tsx
- Intersection Observer 懒加载
- 骨架屏占位符
- 渲染进度指示器
- 性能统计 (开发模式)
```

### 6.4 性能指标

| 文档大小 | 渲染方式 | Worker | 预期 FPS |
|---------|---------|--------|----------|
| < 50KB | 普通 | ❌ | 60 |
| 50-100KB | 虚拟滚动 | ✅ | 60 |
| 100KB-500KB | 虚拟滚动 | ✅ | 30+ |
| > 500KB | 虚拟滚动 | ✅ | 30+ |

---

## 7. 所见即所得设计方案（待实现）

### 7.1 方案对比

| 方案 | 优点 | 缺点 | 代表产品 |
|------|------|------|----------|
| 双栏预览 | 简单可靠 | 非所见即所得 | VS Code |
| 块级 WYSIWYG | 块内所见即所得 | 块间需切换 | Notion, 语雀 |
| 行内 WYSIWYG | 完全所见即所得 | 复杂度高 | Typora |

### 7.2 推荐方案：Milkdown

```typescript
// 预计实现架构
import { Editor } from '@milkdown/core';
import { commonmark } from '@milkdown/preset-commonmark';
import { gfm } from '@milkdown/preset-gfm';
import { math } from '@milkdown/plugin-math';
import { diagram } from '@milkdown/plugin-diagram';
import { slash } from '@milkdown/plugin-slash'; // 斜杠命令

Editor
  .make()
  .use(commonmark)   // 基础 Markdown
  .use(gfm)          // GitHub 风格
  .use(math)         // 数学公式
  .use(diagram)      // Mermaid 图表
  .use(slash)        // / 命令面板
  .create();
```

---

## 9. 依赖列表（当前版本）

```json
{
  "dependencies": {
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    
    "marked": "^17.0.1",
    "marked-highlight": "^2.2.3",
    "highlight.js": "^11.11.1",
    
    "katex": "^0.16.27",
    "mermaid": "^11.12.2",
    
    "@codemirror/lang-markdown": "^6.5.0",
    "@codemirror/state": "^6.5.3",
    "@codemirror/view": "^6.39.8",
    "@codemirror/commands": "^6.10.1",
    "@codemirror/search": "^6.5.0",
    "@codemirror/language": "^6.12.1",
    "codemirror": "^6.0.2",
    
    "zustand": "^5.0.9"
  },
  "devDependencies": {
    "@tauri-apps/api": "^2.9.1",
    "@tauri-apps/cli": "^2.9.6",
    "@tauri-apps/plugin-fs": "^2.4.4",
    "@tauri-apps/plugin-dialog": "^2.4.2",
    
    "html2canvas": "^1.4.1",
    
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@types/katex": "^0.16.7",
    "@vitejs/plugin-react": "^5.1.1",
    "typescript": "~5.9.3",
    "vite": "^7.2.4"
  }
}
```

---

## 10. 开发进度

### 第一阶段：Web 核心功能 ✅ 已完成

| 任务 | 状态 | 说明 |
|-----|------|------|
| 搭建项目框架 | ✅ | React 19 + Vite 7 + TypeScript |
| 集成 CodeMirror 编辑器 | ✅ | 含搜索替换 |
| 实现 Markdown 实时预览 | ✅ | 普通 + 虚拟滚动双模式 |
| 实现主题系统 | ✅ | 4 个主题 (GitHub + 3 微信) |
| 集成 KaTeX 公式 | ✅ | 行内 + 块级 |
| 集成 Mermaid 图表 | ✅ | 流程图/时序图等 |
| 图片粘贴 | ✅ | Base64 + 本地存储 |
| 液态玻璃 UI | ✅ | iOS 26 风格 |

### 第二阶段：完善功能 ✅ 已完成

| 任务 | 状态 | 说明 |
|-----|------|------|
| 文件打开/保存 | ✅ | ⌘O/⌘S/⇧⌘S |
| 大纲导航 | ✅ | 标题提取 + 点击跳转 |
| 自动保存 | ✅ | 防抖 + 失焦 + localStorage |
| 导出功能 | ✅ | HTML/PDF/PNG |
| 大文件优化 | ✅ | 虚拟滚动 + Web Worker |
| 图片本地存储 | ✅ | Typora 风格 .assets 目录 |

### 第三阶段：桌面应用 ✅ 已完成

| 任务 | 状态 | 说明 |
|-----|------|------|
| 集成 Tauri | ✅ | Tauri 2.0 |
| 本地文件系统 | ✅ | fs + dialog 插件 |
| 打包发布 | ✅ | macOS .app/.dmg |

### 第四阶段：待完成

| 任务 | 优先级 | 说明 |
|-----|--------|------|
| 图床上传 | P1 | GitHub/SM.MS API |
| 微信公众号复制 | P2 | 富文本 clipboard |
| 所见即所得 | P2 | Milkdown 集成 |
| 拖拽分割线 | P2 | 调整面板大小 |

---

## 11. 参考资源

### 开源项目
- [doocs/md](https://github.com/doocs/md) - 微信 Markdown 编辑器
- [Typora](https://typora.io/) - 功能参考
- [MarkEdit](https://github.com/MarkEdit-app/MarkEdit) - macOS 原生编辑器
- [MarkText](https://github.com/marktext/marktext) - Electron 实现参考
- [Milkdown](https://milkdown.dev/) - WYSIWYG 方案参考

### 文档
- [marked.js 文档](https://marked.js.org/)
- [KaTeX 文档](https://katex.org/docs/api.html)
- [Mermaid 文档](https://mermaid.js.org/)
- [CodeMirror 6 文档](https://codemirror.net/docs/)
- [Tauri 文档](https://tauri.app/zh-cn/)

### 字体资源
- [Google Fonts](https://fonts.google.com/)
- [思源字体](https://github.com/adobe-fonts/source-han-sans)

---

## 12. 更新日志

### v1.0.0 (2026-01-06)
- ✅ 初始化项目框架
- ✅ CodeMirror 6 编辑器 (含搜索替换)
- ✅ Markdown 实时预览
- ✅ KaTeX 数学公式
- ✅ Mermaid 图表
- ✅ 4 种主题 (GitHub + 3 微信)
- ✅ 图片粘贴 (Base64 + 本地存储)
- ✅ 文件打开/保存/另存为
- ✅ 导出 HTML/PDF/PNG
- ✅ 自动保存 (防抖 + 失焦 + 本地备份)
- ✅ 大纲导航
- ✅ 大文件优化 (虚拟滚动 + Web Worker)
- ✅ Tauri 桌面应用 (macOS)
